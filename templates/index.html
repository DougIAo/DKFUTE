{% extends "base.html" %}

{% block title %}Compre sua Transmissão de Futebol{% endblock %}

{% block head_extra %}
<style>
    /* Efeito de Pulso para o Botão */
    .animate-pulse-dk {
        animation: pulse-dk 2s infinite;
    }
    @keyframes pulse-dk {
        0%, 100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5); /* Cor baseada no bg-blue-600 */
        }
        50% {
            transform: scale(1.02); /* Leve aumento */
            box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); /* Sombra some */
        }
    }

    /* Animação para o ícone de futebol */
    .icon-spin-slow {
        animation: spin-slow 3s linear infinite;
    }
    @keyframes spin-slow {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-lg mx-auto bg-white p-8 sm:p-10 rounded-xl shadow-2xl">
    <header class="text-center mb-8">
        <i class="fas fa-tv text-5xl text-blue-600 mb-4"></i>
        <h1 class="text-3xl sm:text-4xl font-bold font-poppins text-slate-700">Futebol Ao Vivo!</h1>
        <p class="text-md sm:text-lg text-slate-500 mt-2">
            Assista o jogo completo por apenas <span class="font-semibold text-green-600">R$ 3,00</span>!
        </p>
    </header>

    <form id="registrationForm" class="space-y-6">
        <div>
            <label for="name" class="block text-sm font-medium text-slate-700 mb-1">Nome:</label>
            <input type="text" id="name" name="name" required
                   class="mt-1 block w-full px-4 py-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm placeholder-slate-400"
                   placeholder="Seu nome">
        </div>

        <div>
            <label for="whatsapp" class="block text-sm font-medium text-slate-700 mb-1">Número do WhatsApp (com DDD):</label>
            <input type="tel" id="whatsapp" name="whatsapp" required
                   class="mt-1 block w-full px-4 py-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm placeholder-slate-400"
                   placeholder="(XX) XXXXX-XXXX">
        </div>
        
        <div>
            <label for="time_torce" class="block text-sm font-medium text-slate-700 mb-1">Qual time você torce?</label>
            <input type="text" id="time_torce" name="time_torce" required
                   class="mt-1 block w-full px-4 py-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm placeholder-slate-400"
                   placeholder="Ex: Flamengo, Corinthians, etc.">
            <p class="mt-1 text-xs text-slate-500">Essa informação é obrigatória.</p>
        </div>

        <div>
            <label for="email" class="block text-sm font-medium text-slate-700 mb-1">E-mail (Opcional):</label>
            <input type="email" id="email" name="email"
                   class="mt-1 block w-full px-4 py-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm placeholder-slate-400"
                   placeholder="seuemail@exemplo.com">
            <p class="mt-1 text-xs text-slate-500">Para confirmações e contato.</p>
        </div>

        {# === BOTÃO MODIFICADO === #}
        <button type="submit" id="submitButton"
                class="w-full flex items-center justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out animate-pulse-dk">
            <i class="fas fa-futbol mr-2 icon-spin-slow"></i> {# Ícone de futebol com animação #}
            Pagar com PIX para Liberar o Jogo
        </button>
        {# === FIM DO BOTÃO MODIFICADO === #}
    </form>

    <div class="mt-6 text-center">
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md shadow" role="alert">
            <div class="flex items-center">
                <div class="py-1">
                    <i class="fas fa-bell text-xl mr-3"></i> 
                </div>
                <div>
                    <p class="font-semibold text-sm">Atenção:</p>
                    <p class="text-xs sm:text-sm"> 
                        Assim que o Mercado Pago confirmar seu pagamento, o link da transmissão será enviado para o número de WhatsApp cadastrado.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="paymentStatus" class="mt-4 text-center text-sm"></div>

    {# === SEÇÃO DE AVALIAÇÕES === #}
    <div class="mt-10 pt-6 border-t border-slate-200">
        <h2 class="text-xl font-bold font-poppins text-slate-700 text-center mb-5">Nossos Clientes Satisfeitos</h2>
        <div class="space-y-4"> 
            <div class="bg-sky-50 p-4 rounded-xl shadow-lg border-l-4 border-sky-500">
                <div class="flex items-center mb-2"> 
                    <i class="fas fa-user-circle text-3xl text-sky-600 mr-2"></i>
                    <div><h4 class="font-semibold text-slate-800 text-sm">Carlos A.</h4><p class="text-xs text-slate-500">Torcedor do Palmeiras</p></div>
                </div>
                <blockquote class="mb-2"><p class="text-slate-700 text-sm leading-relaxed italic"><span class="text-xl text-sky-600 font-serif leading-none mr-1">“</span>Qualidade ótima e preço justo. Vi o jogo do Verdão sem travar. Recomendo!<span class="text-xl text-sky-600 font-serif leading-none ml-1">”</span></p></blockquote>
                <div class="flex items-center text-yellow-400 text-xs"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i><span class="ml-1.5 text-xs text-slate-600 font-medium">(4.9/5)</span></div>
            </div>
            <div class="bg-emerald-50 p-4 rounded-xl shadow-lg border-l-4 border-emerald-500">
                <div class="flex items-center mb-2"><i class="fas fa-user-circle text-3xl text-emerald-600 mr-2"></i><div><h4 class="font-semibold text-slate-800 text-sm">Mariana L.</h4><p class="text-xs text-slate-500">Torcedora do Flamengo</p></div></div>
                <blockquote class="mb-2"><p class="text-slate-700 text-sm leading-relaxed italic"><span class="text-xl text-emerald-600 font-serif leading-none mr-1">“</span>Fácil de comprar e acesso imediato. Perfeito para não perder nenhum lance do Mengão!<span class="text-xl text-emerald-600 font-serif leading-none ml-1">”</span></p></blockquote>
                <div class="flex items-center text-yellow-400 text-xs"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><span class="ml-1.5 text-xs text-slate-600 font-medium">(5.0/5)</span></div>
            </div>
            <div class="bg-violet-50 p-4 rounded-xl shadow-lg border-l-4 border-violet-500">
                <div class="flex items-center mb-2"><i class="fas fa-user-circle text-3xl text-violet-600 mr-2"></i><div><h4 class="font-semibold text-slate-800 text-sm">Fernando C.</h4><p class="text-xs text-slate-500">Torcedor do Corinthians</p></div></div>
                <blockquote class="mb-2"><p class="text-slate-700 text-sm leading-relaxed italic"><span class="text-xl text-violet-600 font-serif leading-none mr-1">“</span>Plataforma show! Atendimento rápido e eficiente. Valeu cada centavo pra ver o Timão!<span class="text-xl text-violet-600 font-serif leading-none ml-1">”</span></p></blockquote>
                <div class="flex items-center text-yellow-400 text-xs"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><span class="ml-1.5 text-xs text-slate-600 font-medium">(4.0/5)</span></div>
            </div>
        </div>
    </div>
    {# === FIM DA SEÇÃO DE AVALIAÇÕES === #}
</div>
{% endblock %}

{% block scripts_extra %}
<script>
    // ... (seu JavaScript existente para o formulário, sem alterações na lógica) ...
    const registrationForm = document.getElementById('registrationForm');
    const submitButton = document.getElementById('submitButton');
    const paymentStatusDiv = document.getElementById('paymentStatus');

    registrationForm.addEventListener('submit', async function(event) {
        event.preventDefault();
        const originalButtonContent = submitButton.innerHTML; // Salva o conteúdo HTML, incluindo o ícone
        const originalButtonClasses = submitButton.className; // Salva as classes originais
        
        // Remove animação de pulso ao clicar, adiciona spinner
        submitButton.classList.remove('animate-pulse-dk');
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Aguarde, preparando pagamento...';
        paymentStatusDiv.innerHTML = '';

        const name = document.getElementById('name').value.trim();
        const whatsapp = document.getElementById('whatsapp').value.trim();
        const time_torce = document.getElementById('time_torce').value.trim();
        const email = document.getElementById('email').value.trim();

        let errors = [];
        if (!name) errors.push("Nome");
        if (!whatsapp) errors.push("WhatsApp");
        if (!time_torce) errors.push("Time que torce");

        if (errors.length > 0) {
            paymentStatusDiv.innerHTML = `<p class="text-red-500 p-3 bg-red-100 rounded-md">Por favor, preencha: ${errors.join(', ')}.</p>`;
            submitButton.disabled = false;
            submitButton.innerHTML = originalButtonContent; // Restaura conteúdo original
            submitButton.className = originalButtonClasses; // Restaura classes originais (incluindo a de pulso)
            return;
        }
        
        try {
            const response = await fetch("{{ url_for('create_preference') }}", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, whatsapp, time_torce, email })
            });

            const responseData = await response.json(); 
            if (!response.ok) {
                throw new Error(responseData.error || `Servidor retornou erro ${response.status}`);
            }
            if (responseData.checkout_url) {
                window.location.href = responseData.checkout_url;
            } else {
                throw new Error("URL de checkout não recebida do servidor.");
            }
        } catch (error) {
            console.error("Erro ao criar preferência ou redirecionar:", error);
            paymentStatusDiv.innerHTML = `<p class="text-red-600 p-3 bg-red-100 rounded-md shadow">Erro: ${error.message}. Tente novamente.</p>`;
            submitButton.disabled = false;
            submitButton.innerHTML = originalButtonContent; // Restaura conteúdo original
            submitButton.className = originalButtonClasses; // Restaura classes originais
        }
    });
</script>
{% endblock %}
